{{ $.Scratch.Add "index" slice }}

{{ range where site.RegularPages "Section" "blog" }}
    {{ $date := .PublishDate.Format ":date_long" }}
    {{ $image := "" }}

    {{ with .Params.image }}
        {{ $imagePath := printf "assets/%s" . }}
        {{ if fileExists $imagePath }}
            {{ $imageResource := resources.Get . }}
            {{ if $imageResource }}
                {{ $resizedImage := $imageResource.Resize "650x" }}
                {{ $image = $resizedImage.RelPermalink }}
            {{ end }}
        {{ end }}
    {{ end }}

    {{ $.Scratch.Add "index" (dict 
        "title" .Title 
        "date" $date 
        "image" $image 
        "categories" .Params.categories 
        "contents" .Plain 
        "permalink" .RelPermalink) }}
{{ end }}

{{ $.Scratch.Get "index" | jsonify }}
